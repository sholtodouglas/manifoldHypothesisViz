(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{276:function(e,t,a){e.exports=a(302)},282:function(e,t,a){},287:function(e,t){},288:function(e,t){},296:function(e,t){},299:function(e,t){},300:function(e,t){},301:function(e,t){},302:function(e,t,a){"use strict";a.r(t);var n=a(9),r=a.n(n),o=a(135),s=a.n(o),l=a(49),c=a(225),i=a(12);Object(l.d)({TrackballControls:c.a});var u=n.forwardRef((e,t)=>{let{}=e;const a=n.useRef(),{camera:r,gl:o}=Object(l.g)();return Object(l.f)(()=>{a.current.update()}),n.useImperativeHandle(t,()=>({resetCamera:()=>{a.current.target.set(0,0,0),r.position.set(0,0,2),r.up.set(a.current.up0.x,a.current.up0.y,a.current.up0.z)}})),n.createElement("trackballControls",{ref:a,args:[r,o.domElement],dynamicDampingFactor:.1,keys:[18,17,91],mouseButtons:{LEFT:i.MOUSE.PAN,MIDDLE:i.MOUSE.ZOOM,RIGHT:i.MOUSE.ROTATE}})}),m=a(176);const d=e=>{let{data:t,layout:a="grid",modelOutputs:r}=e;n.useEffect(()=>{if(void 0===r)switch(a){case"spiral":!function(e){let t=0;for(let a=0;a<e.length;++a){const n=e[a];let r=Math.max(1,.8*Math.sqrt(a+1));t+=1*Math.asin(1/r),r/=150,n.x=r*Math.cos(t),n.y=r*Math.sin(t),n.z=0}}(t);break;case"torus":!function(e){let t=e.length/2,a=0,n=0;for(let r=0;r<t;++r){const o=e[r];a+=2*Math.PI/t,n+=2*Math.PI/(t/50),o.x=(.3+.1*Math.cos(n))*Math.cos(a),o.y=(.3+.1*Math.cos(n))*Math.sin(a),o.z=.1*Math.sin(n)}a=0,n=0;for(let r=t;r<2*t;++r){const o=e[r];a+=2*Math.PI/t,n+=2*Math.PI/(t/50),o.x=(.3+.1*Math.cos(n))*Math.cos(a)+.3,o.z=(.3+.1*Math.cos(n))*Math.sin(a),o.y=.1*Math.sin(n)}}(t);break;case"grid":default:!function(e){const t=e.length,a=Math.ceil(Math.sqrt(t)),n=a;for(let r=0;r<t;++r){const t=e[r],o=r%a-a/2,s=Math.floor(r/a)-n/2;t.x=o/a,t.y=s/n,t.z=0}}(t)}else!function(e,t){const a=e.length;for(let n=0;n<a;++n){const a=e[n];void 0===t||(a.x=t[3*n],a.y=t[3*n+1],a.z=t[3*n+2])}}(t,r)},[t,a,r])};function h(e){let{data:t,layout:a,onFrame:r,modelOutputs:o}=e;!function(e){let{data:t,layout:a,modelOutputs:r}=e;n.useEffect(()=>{for(let e=0;e<t.length;++e)t[e].sourceX=(t[e].x||0).valueOf(),t[e].sourceY=(t[e].y||0).valueOf(),t[e].sourceZ=(t[e].z||0).valueOf()},[t,a,r]),d({data:t,layout:a,modelOutputs:r}),n.useEffect(()=>{for(let e=0;e<t.length;++e)t[e].targetX=t[e].x,t[e].targetY=t[e].y,t[e].targetZ=t[e].z},[t,a,r])}({data:t,layout:a,modelOutputs:o});const s=n.useRef(a),l=Object(m.b)({animationProgress:1,from:{animationProgress:0},reset:a!==s.current,onFrame:e=>{let{animationProgress:a}=e;!function(e,t,a){for(let n=0;n<e.length;++n)e[n].x=(1-t)*e[n].sourceX+t*e[n].targetX,e[n].y=(1-t)*e[n].sourceY+t*e[n].targetY,e[n].z=(1-t)*e[n].sourceZ+t*e[n].targetZ}(t,a),r({animationProgress:a})}});return s.current=a,l}const f=new i.Object3D;function p(e){let{mesh:t,data:a}=e;if(t){for(let e=0;e<a.length;++e){const{x:n,y:r,z:o}=a[e];f.position.set(n,r,o),f.rotation.set(.5*Math.PI,0,0),f.updateMatrix(),t.setMatrixAt(e,f.matrix)}t.instanceMatrix.needsUpdate=!0}}const g=new i.Color;var y=e=>{let{data:t,labels:a,layout:r,selectedPoint:o,onSelectPoint:s,modelOutputs:l}=e;const c=n.useRef(),u=t.length,{animationProgress:d}=h({data:t,layout:r,onFrame:()=>{p({mesh:c.current,data:t})},modelOutputs:l});n.useEffect(()=>{p({mesh:c.current,data:t})},[t,r]);const{handleClick:f,handlePointerDown:y}=(e=>{let{data:t,selectedPoint:a,onSelectPoint:r}=e;const o=n.useRef([0,0]);return{handlePointerDown:e=>{o.current[0]=e.clientX,o.current[1]=e.clientY},handleClick:e=>{const{instanceId:a,clientX:n,clientY:s}=e;if(Math.sqrt(Math.pow(o.current[0]-n,2)+Math.pow(o.current[1]-s,2))>5)return void e.stopPropagation();const l=t[a];r(l)}}})({data:t,selectedPoint:o,onSelectPoint:s}),{colorAttrib:E,colorArray:b}=(e=>{let{data:t,labels:a,selectedPoint:r}=e;const o=t.length,s=n.useRef(),l=n.useMemo(()=>new Float32Array(3*o),[o]);return n.useEffect(()=>{for(let e=0;e<t.length;++e)g.set(1===a[e]?"#E74C3C":"#2E86C1"),g.toArray(l,3*e);s.current.needsUpdate=!0},[t,r,l]),{colorAttrib:s,colorArray:l}})({data:t,labels:a,selectedPoint:o});return n.createElement(n.Fragment,null,n.createElement("instancedMesh",{ref:c,args:[null,null,u],frustumCulled:!1,onClick:f,onPointerDown:y},n.createElement("sphereBufferGeometry",{attach:"geometry",args:[.005,.005,.005]},n.createElement("instancedBufferAttribute",{ref:E,attachObject:["attributes","color"],args:[b,3]})),n.createElement("meshStandardMaterial",{attach:"material",vertexColors:i.VertexColors})),o&&n.createElement(m.a.group,{position:d.interpolate(()=>[o.x,o.y,o.z])},n.createElement("pointLight",{distance:.9,position:[0,0,.3],intensity:.2,decay:30,color:"#3f3"}),n.createElement("pointLight",{position:[0,0,0],decay:1,distance:.5,intensity:1,color:"#2f0"})))},E=a(252),b=a(136),v=a(229),M=a(253),P=a(230);function w(){const e=Object(n.useRef)(),{scene:t,gl:a,size:o,camera:s}=Object(l.g)(),c=Object(n.useMemo)(()=>new i.Vector2(o.width,o.height),[o]);Object(n.useEffect)(()=>void e.current.setSize(o.width,o.height),[o]),Object(l.f)(()=>e.current.render(),1);const u={resolution:c,strength:6e-4,radius:1e-5,threshold:4e-4};return r.a.createElement("effectComposer",{ref:e,args:[a]},r.a.createElement("renderPass",{attachArray:"passes",scene:t,camera:s}),r.a.createElement("unrealBloomPass",{attachArray:"passes",args:[u.resolution,u.strength,u.radius,u.threshold]}),r.a.createElement("shaderPass",{attachArray:"passes",args:[P.a],"material-uniforms-resolution-value":[1/o.width,1/o.height],renderToScreen:!0}))}Object(l.d)({EffectComposer:E.a,ShaderPass:b.a,RenderPass:v.a,UnrealBloomPass:M.a});var C=n.forwardRef((e,t)=>{let{data:a,labels:r,layout:o,selectedPoint:s,onSelectPoint:c,modelOutputs:i}=e;const m=n.useRef();return n.useImperativeHandle(t,()=>({resetCamera:()=>m.current.resetCamera()})),n.createElement(l.a,{camera:{position:[0,0,2],far:15e3}},n.createElement(u,{ref:m}),n.createElement("ambientLight",{color:"#ffffff",intensity:.1}),n.createElement("hemisphereLight",{color:"#ffffff",skyColor:"#ffffbb",groundColor:"#080820",intensity:1}),n.createElement(y,{data:a,labels:r,layout:o,selectedPoint:s,onSelectPoint:c,modelOutputs:i}),n.createElement(w,null),n.createElement("axesHelper",null))}),O=(a(282),a(44));const x=2e3,S=new Array(x).fill(0).map((e,t)=>({id:t})),k=new Array(x/2).fill(0).concat(new Array(x/2).fill(1)),N=1e3;var A=O.i.adam(.01);const z=function(e){const t=new Array(x).fill(0).map((e,t)=>({id:t}));for(let a=0;a<e.length;++a)t[a]=Object.assign({},e[a]);return t}(S);var R=[3,3,3,2],j=[],I=R.length-1,D=[0,3];function L(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];j=[];for(let t=0;t<e.length-1;t++)j.push(O.j(O.e([e[t],e[t+1]]))),console.log(e[t]),j.push(O.j(O.e([e[t+1]])));A=O.i.adam(.01)}function T(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;t<0?t=j.length:t*=2;for(let a=0;a<t;a++)e=e.matMul(j[a]),a++,e=(e=e.add(j[a])).tanh();return e}async function Y(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16;16==e&&(e=N);const t=S.map(e=>[e.x,e.y,e.z]),a=O.h(t,[t.length,3]),n=O.d(k,2),r=O.f([e],0,x,"int32");return[a.gather(r),n.gather(r)]}function B(){const[e,t]=n.useState("torus"),[a,r]=n.useState("custom"),[o,s]=n.useState(null),[l,c]=n.useState(Date.now()),[i,u]=n.useState(void 0),[m,d]=n.useState("3,3,3,2"),[h,f]=n.useState(0),p=n.useRef(),g=n.useRef(),y=e=>{console.log("Selected point",e);const t=e.id;k[t]=Math.abs(1-k[t]),s(e);let a=O.h([[e.x,e.y,e.z]],[1,3]);console.log("Pred",T(a).softmax().dataSync())};async function E(){try{!async function(){const[e,t]=await Y();console.log(e),A.minimize(()=>{const a=T(e),n=O.c.softmaxCrossEntropy(t,a);return n.data().then(e=>console.log("Loss",e)),n})}();const[a,n]=await Y(32),o=T(a);f(await O.c.softmaxCrossEntropy(n,o).data());var e=T(function(){const e=S.map(e=>[e.x,e.y,e.z]);return O.h(e,[e.length,3])}(),I);I==R.length-1&&(e=e.softmax()),2==e.shape[1]?e=O.b([e,O.k([e.shape[0],1])],1):e.shape[1]>3&&(e=O.g(e,[0,D[0]],[x,D[1]]));const s=O.h(z.map(e=>[e.x,e.y,e.z]),[x,3]),l=O.a(s.mul(.7),e.mul(.3));u(l.dataSync());let c="custom"+Date.now();r(c)}catch(t){console.error(t)}}return n.useEffect(()=>{setTimeout(()=>L(R),50);const e=setInterval(()=>E(),100);return()=>{clearInterval(e)}},[]),n.createElement("div",null,n.createElement("div",{className:"Header"},n.createElement("h1",null," Visualising neural net training through manifold transformations"),"On the left is a binary dataset - ranging in complexity from a 2D grid to two intersecting tori. On the right is the neural net's attempt to separate the classes. The best introduction to the 'manifold theory' of neural networks is ",n.createElement("a",{href:"https://colah.github.io/posts/2014-03-NN-Manifolds-Topology/",rel:"noreferrer"},"Chris Olah's post on neural nets, manifolds and topology"),", and still the best way to understand the intuition is ",n.createElement("a",{href:"https://cs.stanford.edu/people/karpathy/convnetjs//demo/classify2d.html",rel:"noreferrer"},"Karpathy's 2D ConvNetJS demo"),n.createElement("br",null),"By visualising it in three dimensions it lets us explore some of the more complex examples (such as the tori), and visualise how a three dimensional layer is necessary to separate some two dimensional shapes (such as the spiral).",n.createElement("br",null),n.createElement("br",null),"In order to successfully separate the tori examples - you'll need to change the model layers to include at least one four dimensional layer - can you think about why?",n.createElement("br",null),n.createElement("br",null),"Click nodes to change their class. Click the buttons to visualise specific layers, or submit the form to change the layers of the neural net (the input layer must be three dimensional, and the output layer two dimensional) Where a layer has more than 3 neurons, the first 3 are visualised. Tanh activations are used to bound the outputs of each layer and make it easier to visualise."),n.createElement("div",{className:"App"},n.createElement("div",{className:"AppLHS"},n.createElement("div",{className:"vis-container"},n.createElement(C,{ref:p,data:S,labels:k,layout:e,selectedPoint:o,onSelectPoint:y})),n.createElement("button",{className:"reset-button",onClick:()=>{p.current.resetCamera()}},"Reset Camera"),n.createElement("div",{className:"controls"},n.createElement("strong",null,"Layouts")," ",n.createElement("button",{onClick:()=>t("grid"),className:"grid"===e?"active":void 0},"Grid"),n.createElement("button",{onClick:()=>t("spiral"),className:"spiral"===e?"active":void 0},"Spiral"),n.createElement("button",{onClick:()=>t("torus"),className:"torus"===e?"active":void 0},"Torus"),o&&n.createElement("div",{className:"selected-point"},"You selected ",n.createElement("strong",null,o.id)))),n.createElement("div",{className:"AppRHS"},n.createElement("div",{className:"vis-container"},n.createElement(C,{ref:g,data:z,labels:k,layout:a,selectedPoint:o,onSelectPoint:y,modelOutputs:i})),n.createElement("button",{className:"reset-button",onClick:()=>{g.current.resetCamera()}},"Reset Camera"),n.createElement("div",{className:"controls"},n.createElement("strong",null,"Select Layer")," ",n.createElement("form",{onSubmit:e=>{e.preventDefault(),R=m.split(",").map(Number),console.log(R),L(R)}},n.createElement("label",null,"Model layers:",n.createElement("input",{type:"text",value:m,onChange:e=>d(e.target.value)})),n.createElement("input",{type:"submit",value:"Update layers"})),n.createElement("div",null,R.map((e,t)=>n.createElement("button",{className:"reset-button",onClick:()=>(function(e){I=e})(t),className:I===t?"active":void 0},e)),n.createElement("div",null,"Loss: ",h)),o&&n.createElement("div",{className:"selected-point"},"You selected ",n.createElement("strong",null,o.id))))))}const F=document.getElementById("root");s.a.render(r.a.createElement(B,null),F)}},[[276,1,2]]]);
//# sourceMappingURL=main.ed637009.chunk.js.map