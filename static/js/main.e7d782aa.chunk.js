(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{276:function(e,t,a){e.exports=a(302)},282:function(e,t,a){},287:function(e,t){},288:function(e,t){},296:function(e,t){},299:function(e,t){},300:function(e,t){},301:function(e,t){},302:function(e,t,a){"use strict";a.r(t);var n=a(9),r=a.n(n),s=a(135),o=a.n(s),l=a(49),c=a(225),i=a(12);Object(l.d)({TrackballControls:c.a});var u=n.forwardRef((e,t)=>{let{}=e;const a=n.useRef(),{camera:r,gl:s}=Object(l.g)();return Object(l.f)(()=>{a.current.update()}),n.useImperativeHandle(t,()=>({resetCamera:()=>{a.current.target.set(0,0,0),r.position.set(0,0,1.5),r.up.set(a.current.up0.x,a.current.up0.y,a.current.up0.z)}})),n.createElement("trackballControls",{ref:a,args:[r,s.domElement],dynamicDampingFactor:.1,keys:[18,17,91],mouseButtons:{LEFT:i.MOUSE.PAN,MIDDLE:i.MOUSE.ZOOM,RIGHT:i.MOUSE.ROTATE}})}),m=a(176);const d=e=>{let{data:t,layout:a="grid",modelOutputs:r}=e;n.useEffect(()=>{if(void 0===r)switch(a){case"spiral":!function(e){let t=0;for(let a=0;a<e.length;++a){const n=e[a];let r=Math.max(1,.8*Math.sqrt(a+1));t+=1*Math.asin(1/r),r/=150,n.x=r*Math.cos(t),n.y=r*Math.sin(t),n.z=0}}(t);break;case"torus":!function(e){let t=e.length/2,a=0,n=0;for(let r=0;r<t;++r){const s=e[r];a+=2*Math.PI/t,n+=2*Math.PI/(t/50),s.x=(.3+.1*Math.cos(n))*Math.cos(a),s.y=(.3+.1*Math.cos(n))*Math.sin(a),s.z=.1*Math.sin(n)}a=0,n=0;for(let r=t;r<2*t;++r){const s=e[r];a+=2*Math.PI/t,n+=2*Math.PI/(t/50),s.x=(.3+.1*Math.cos(n))*Math.cos(a)+.3,s.z=(.3+.1*Math.cos(n))*Math.sin(a),s.y=.1*Math.sin(n)}}(t);break;case"grid":default:!function(e){const t=e.length,a=Math.ceil(Math.sqrt(t)),n=a;for(let r=0;r<t;++r){const t=e[r],s=r%a-a/2,o=Math.floor(r/a)-n/2;t.x=s/a,t.y=o/n,t.z=0}}(t)}else!function(e,t){const a=e.length;for(let n=0;n<a;++n){const a=e[n];void 0===t||(a.x=t[3*n],a.y=t[3*n+1],a.z=t[3*n+2])}}(t,r)},[t,a,r])};function h(e){let{data:t,layout:a,onFrame:r,modelOutputs:s}=e;!function(e){let{data:t,layout:a,modelOutputs:r}=e;n.useEffect(()=>{for(let e=0;e<t.length;++e)t[e].sourceX=(t[e].x||0).valueOf(),t[e].sourceY=(t[e].y||0).valueOf(),t[e].sourceZ=(t[e].z||0).valueOf()},[t,a,r]),d({data:t,layout:a,modelOutputs:r}),n.useEffect(()=>{for(let e=0;e<t.length;++e)t[e].targetX=t[e].x,t[e].targetY=t[e].y,t[e].targetZ=t[e].z},[t,a,r])}({data:t,layout:a,modelOutputs:s});const o=n.useRef(a),l=Object(m.b)({animationProgress:1,from:{animationProgress:0},reset:a!==o.current,onFrame:e=>{let{animationProgress:a}=e;!function(e,t,a){for(let n=0;n<e.length;++n)e[n].x=(1-t)*e[n].sourceX+t*e[n].targetX,e[n].y=(1-t)*e[n].sourceY+t*e[n].targetY,e[n].z=(1-t)*e[n].sourceZ+t*e[n].targetZ}(t,a),r({animationProgress:a})}});return o.current=a,l}const f=new i.Object3D;function p(e){let{mesh:t,data:a}=e;if(t){for(let e=0;e<a.length;++e){const{x:n,y:r,z:s}=a[e];f.position.set(n,r,s),f.rotation.set(.5*Math.PI,0,0),f.updateMatrix(),t.setMatrixAt(e,f.matrix)}t.instanceMatrix.needsUpdate=!0}}const g=new i.Color;var y=e=>{let{data:t,labels:a,layout:r,selectedPoint:s,onSelectPoint:o,modelOutputs:l}=e;const c=n.useRef(),u=t.length,{animationProgress:d}=h({data:t,layout:r,onFrame:()=>{p({mesh:c.current,data:t})},modelOutputs:l});n.useEffect(()=>{p({mesh:c.current,data:t})},[t,r]);const{handleClick:f,handlePointerDown:y}=(e=>{let{data:t,selectedPoint:a,onSelectPoint:r}=e;const s=n.useRef([0,0]);return{handlePointerDown:e=>{s.current[0]=e.clientX,s.current[1]=e.clientY},handleClick:e=>{const{instanceId:a,clientX:n,clientY:o}=e;if(Math.sqrt(Math.pow(s.current[0]-n,2)+Math.pow(s.current[1]-o,2))>5)return void e.stopPropagation();const l=t[a];r(l)}}})({data:t,selectedPoint:s,onSelectPoint:o}),{colorAttrib:E,colorArray:b}=(e=>{let{data:t,labels:a,selectedPoint:r}=e;const s=t.length,o=n.useRef(),l=n.useMemo(()=>new Float32Array(3*s),[s]);return n.useEffect(()=>{for(let e=0;e<t.length;++e)g.set(1===a[e]?"#E74C3C":"#2E86C1"),g.toArray(l,3*e);o.current.needsUpdate=!0},[t,r,l]),{colorAttrib:o,colorArray:l}})({data:t,labels:a,selectedPoint:s});return n.createElement(n.Fragment,null,n.createElement("instancedMesh",{ref:c,args:[null,null,u],frustumCulled:!1,onClick:f,onPointerDown:y},n.createElement("sphereBufferGeometry",{attach:"geometry",args:[.005,.005,.005]},n.createElement("instancedBufferAttribute",{ref:E,attachObject:["attributes","color"],args:[b,3]})),n.createElement("meshStandardMaterial",{attach:"material",vertexColors:i.VertexColors})),s&&n.createElement(m.a.group,{position:d.interpolate(()=>[s.x,s.y,s.z])},n.createElement("pointLight",{distance:.9,position:[0,0,.3],intensity:.2,decay:30,color:"#3f3"}),n.createElement("pointLight",{position:[0,0,0],decay:1,distance:.5,intensity:1,color:"#2f0"})))},E=a(252),b=a(136),v=a(229),w=a(253),M=a(230);function P(){const e=Object(n.useRef)(),{scene:t,gl:a,size:s,camera:o}=Object(l.g)(),c=Object(n.useMemo)(()=>new i.Vector2(s.width,s.height),[s]);Object(n.useEffect)(()=>void e.current.setSize(s.width,s.height),[s]),Object(l.f)(()=>e.current.render(),1);const u={resolution:c,strength:6e-4,radius:1e-5,threshold:4e-4};return r.a.createElement("effectComposer",{ref:e,args:[a]},r.a.createElement("renderPass",{attachArray:"passes",scene:t,camera:o}),r.a.createElement("unrealBloomPass",{attachArray:"passes",args:[u.resolution,u.strength,u.radius,u.threshold]}),r.a.createElement("shaderPass",{attachArray:"passes",args:[M.a],"material-uniforms-resolution-value":[1/s.width,1/s.height],renderToScreen:!0}))}Object(l.d)({EffectComposer:E.a,ShaderPass:b.a,RenderPass:v.a,UnrealBloomPass:w.a});var C=n.forwardRef((e,t)=>{let{data:a,labels:r,layout:s,selectedPoint:o,onSelectPoint:c,modelOutputs:i}=e;const m=n.useRef();return n.useImperativeHandle(t,()=>({resetCamera:()=>m.current.resetCamera()})),n.createElement(l.a,{camera:{position:[0,0,1.5],far:15e3}},n.createElement(u,{ref:m}),n.createElement("ambientLight",{color:"#ffffff",intensity:.1}),n.createElement("hemisphereLight",{color:"#ffffff",skyColor:"#ffffbb",groundColor:"#080820",intensity:1}),n.createElement(y,{data:a,labels:r,layout:s,selectedPoint:o,onSelectPoint:c,modelOutputs:i}),n.createElement(P,null),n.createElement("axesHelper",null))}),O=(a(282),a(44));const x=2e3,S=new Array(x).fill(0).map((e,t)=>({id:t})),k=new Array(x/2).fill(0).concat(new Array(x/2).fill(1)),N=1e3;var A=O.i.adam(.01);const z=function(e){const t=new Array(x).fill(0).map((e,t)=>({id:t}));for(let a=0;a<e.length;++a)t[a]=Object.assign({},e[a]);return t}(S);var R=[3,3,3,2],j=[],D=R.length-1,I=[0,3];function T(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];j=[];for(let t=0;t<e.length-1;t++)j.push(O.j(O.e([e[t],e[t+1]]))),console.log(e[t]),j.push(O.j(O.e([e[t+1]])));A=O.i.adam(.01)}function L(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;t<0?t=j.length:t*=2;for(let a=0;a<t;a++)e=e.matMul(j[a]),a++,e=(e=e.add(j[a])).tanh();return e}async function F(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16;16==e&&(e=N);const t=S.map(e=>[e.x,e.y,e.z]),a=O.h(t,[t.length,3]),n=O.d(k,2),r=O.f([e],0,x,"int32");return[a.gather(r),n.gather(r)]}function Y(){const[e,t]=n.useState("torus"),[a,r]=n.useState("custom"),[s,o]=n.useState(null),[l,c]=n.useState(Date.now()),[i,u]=n.useState(void 0),[m,d]=n.useState("3,3,3,2"),[h,f]=n.useState(0),p=n.useRef(),g=n.useRef(),y=e=>{console.log("Selected point",e);const t=e.id;k[t]=Math.abs(1-k[t]),o(e);O.h([[e.x,e.y,e.z]],[1,3])};async function E(){try{!async function(){const[e,t]=await F();A.minimize(()=>{const a=L(e);return O.c.softmaxCrossEntropy(t,a)})}();const[a,n]=await F(32),s=L(a);f(await O.c.softmaxCrossEntropy(n,s).data());var e=L(function(){const e=S.map(e=>[e.x,e.y,e.z]);return O.h(e,[e.length,3])}(),D);D==R.length-1&&(e=e.softmax()),2==e.shape[1]?e=O.b([e,O.k([e.shape[0],1])],1):e.shape[1]>3&&(e=O.g(e,[0,I[0]],[x,I[1]]));const o=O.h(z.map(e=>[e.x,e.y,e.z]),[x,3]),l=O.a(o.mul(.7),e.mul(.3));u(l.dataSync());let c="custom"+Date.now();r(c)}catch(t){console.error(t)}}return n.useEffect(()=>{setTimeout(()=>T(R),50);const e=setInterval(()=>E(),100);return()=>{clearInterval(e)}},[]),n.createElement("div",null,n.createElement("div",{className:"Header"},n.createElement("h1",null," Visualising neural net training through manifold transformations")),n.createElement("div",{className:"App"},n.createElement("div",{className:"AppLHS"},n.createElement("div",{className:"vis-container"},n.createElement(C,{ref:p,data:S,labels:k,layout:e,selectedPoint:s,onSelectPoint:y})),n.createElement("button",{className:"reset-button",onClick:()=>{p.current.resetCamera()}},"Reset Camera"),n.createElement("div",{className:"controls"},n.createElement("strong",null,"Layouts")," ",n.createElement("button",{onClick:()=>t("grid"),className:"grid"===e?"active":void 0},"Grid"),n.createElement("button",{onClick:()=>t("spiral"),className:"spiral"===e?"active":void 0},"Spiral"),n.createElement("button",{onClick:()=>t("torus"),className:"torus"===e?"active":void 0},"Torus"),s&&n.createElement("div",{className:"selected-point"},"You selected ",n.createElement("strong",null,s.id)))),n.createElement("div",{className:"AppRHS"},n.createElement("div",{className:"vis-container"},n.createElement(C,{ref:g,data:z,labels:k,layout:a,selectedPoint:s,onSelectPoint:y,modelOutputs:i})),n.createElement("button",{className:"reset-button",onClick:()=>{g.current.resetCamera()}},"Reset Camera"),n.createElement("div",{className:"controls"},n.createElement("form",{onSubmit:e=>{e.preventDefault(),3!=(R=0==m.length?[]:m.split(",").map(Number))[0]&&(R=[3,...R]),2!=R[-1]&&R.push(2),console.log(R),T(R)}},n.createElement("label",null,"Layers:",n.createElement("input",{type:"text",value:m,onChange:e=>d(e.target.value)})),n.createElement("input",{type:"submit",value:"Update layers"})),n.createElement("div",null,n.createElement("strong",null,"Select Layer")," ",R.map((e,t)=>n.createElement("button",{className:"reset-button",onClick:()=>(function(e){D=e})(t),className:D===t?"active":void 0},e)),n.createElement("div",null,"Loss:"),n.createElement("div",null,h)),s&&n.createElement("div",{className:"selected-point"},"You selected ",n.createElement("strong",null,s.id))))),n.createElement("div",{className:"Footer"},"On the left is a two class dataset - ranging in complexity from a 2D grid to 3D intersecting tori. This example shows how two class classification is really a matter of stretching the input space in different ways until the two classes are separable by a hyperplane (in this case, a line in the 2D plane). Because neural nets can only stretch and squish the input space, never breaking or cutting it - in some cases we need more dimensions than the original dataset is defined in. E.g the 2D spiral needs a 3 dimensional layer. Play around - how many dimensions do the tori need?",n.createElement("br",null),n.createElement("br",null),"The best introduction to the 'manifold hypothesis' of neural networks is ",n.createElement("a",{href:"https://colah.github.io/posts/2014-03-NN-Manifolds-Topology/",rel:"noreferrer"},"Chris Olah's post on neural nets, manifolds and topology"),". The best way to understand the intuition is ",n.createElement("a",{href:"https://cs.stanford.edu/people/karpathy/convnetjs//demo/classify2d.html",rel:"noreferrer"},"Karpathy's 2D ConvNetJS demo"),", but I thought it would be fun to build a 3D version so that we can better explore the influence of dimensionality.",n.createElement("br",null),n.createElement("br",null),n.createElement("small",null,"Click nodes to change their class. Click the buttons to visualise specific layers, or submit the form to change the layers of the neural net (the input layer must be three dimensional, and the output layer two dimensional) Where a layer has more than 3 neurons, the first 3 are visualised. Tanh activations are used to bound the outputs of each layer and make it easier to visualise.")))}const B=document.getElementById("root");o.a.render(r.a.createElement(Y,null),B)}},[[276,1,2]]]);
//# sourceMappingURL=main.e7d782aa.chunk.js.map